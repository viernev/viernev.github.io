!function(i){"use strict";var r=i.document.documentElement,l={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[Modernizr.prefixed("transition")],h=Modernizr.csstransitions,c=Modernizr.csstransforms3d;function m(e,t){e.style.WebkitTransform=t,e.style.msTransform=t,e.style.transform=t}function d(){var e=r.clientWidth,t=i.innerWidth;return e<t?t:e}function s(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);return e}function e(e,t){this.el=e,this.options=s({},this.options),s(this.options,t),this._init()}e.prototype.options={},e.prototype._init=function(){this.grid=this.el.querySelector("section.grid-wrap > ul.grid"),this.gridItems=[].slice.call(this.grid.querySelectorAll("li:not(.grid-sizer)")),this.itemsCount=this.gridItems.length,this.slideshow=this.el.querySelector("section.slideshow > ul"),this.slideshowItems=[].slice.call(this.slideshow.children),this.current=-1,this.ctrlPrev=this.el.querySelector("section.slideshow > nav > span.nav-prev"),this.ctrlNext=this.el.querySelector("section.slideshow > nav > span.nav-next"),this.ctrlClose=this.el.querySelector("section.slideshow > nav > span.nav-close"),this._initMasonry(),this._initEvents()},e.prototype._initMasonry=function(){var e=this.grid;imagesLoaded(e,function(){new Masonry(e,{itemSelector:"li",columnWidth:e.querySelector(".grid-sizer")})})},e.prototype._initEvents=function(){var s=this;this.gridItems.forEach(function(e,t){e.addEventListener("click",function(){s._openSlideshow(t)})}),this.ctrlPrev.addEventListener("click",function(){s._navigate("prev")}),this.ctrlNext.addEventListener("click",function(){s._navigate("next")}),this.ctrlClose.addEventListener("click",function(){s._closeSlideshow()}),i.addEventListener("resize",function(){s._resizeHandler()}),document.addEventListener("keydown",function(e){if(s.isSlideshowVisible)switch(e.keyCode||e.which){case 37:s._navigate("prev");break;case 39:s._navigate("next");break;case 27:s._closeSlideshow()}}),i.addEventListener("scroll",function(){s.isSlideshowVisible?i.scrollTo(s.scrollPosition?s.scrollPosition.x:0,s.scrollPosition?s.scrollPosition.y:0):s.scrollPosition={x:i.pageXOffset||r.scrollLeft,y:i.pageYOffset||r.scrollTop}})},e.prototype._openSlideshow=function(e){if(this.isSlideshowVisible=!0,this.current=e,classie.addClass(this.el,"slideshow-open"),this._setViewportItems(),classie.addClass(this.currentItem,"current"),classie.addClass(this.currentItem,"show"),this.prevItem){classie.addClass(this.prevItem,"show");var t=Number(-1*(d()/2+this.prevItem.offsetWidth/2));m(this.prevItem,c?"translate3d("+t+"px, 0, -150px)":"translate("+t+"px)")}if(this.nextItem){classie.addClass(this.nextItem,"show");t=Number(d()/2+this.nextItem.offsetWidth/2);m(this.nextItem,c?"translate3d("+t+"px, 0, -150px)":"translate("+t+"px)")}},e.prototype._navigate=function(s){if(!this.isAnimating)if("next"===s&&this.current===this.itemsCount-1||"prev"===s&&0===this.current)this._closeSlideshow();else{this.isAnimating=!0,this._setViewportItems();var i,e,r,n=this,t=this.currentItem.offsetWidth,o=c?"translate3d(-"+Number(d()/2+t/2)+"px, 0, -150px)":"translate(-"+Number(d()/2+t/2)+"px)",a=c?"translate3d("+Number(d()/2+t/2)+"px, 0, -150px)":"translate("+Number(d()/2+t/2)+"px)";"next"===s?(i=c?"translate3d( -"+Number(2*d()/2+t/2)+"px, 0, -150px )":"translate(-"+Number(2*d()/2+t/2)+"px)",e=c?"translate3d( "+Number(2*d()/2+t/2)+"px, 0, -150px )":"translate("+Number(2*d()/2+t/2)+"px)"):(i=c?"translate3d( "+Number(2*d()/2+t/2)+"px, 0, -150px )":"translate("+Number(2*d()/2+t/2)+"px)",e=c?"translate3d( -"+Number(2*d()/2+t/2)+"px, 0, -150px )":"translate(-"+Number(2*d()/2+t/2)+"px)"),classie.removeClass(n.slideshow,"animatable"),("next"===s&&this.current<this.itemsCount-2||"prev"===s&&1<this.current)&&(m(r=this.slideshowItems["next"===s?this.current+2:this.current-2],e),classie.addClass(r,"show"));setTimeout(function(){classie.addClass(n.slideshow,"animatable"),classie.removeClass(n.currentItem,"current");var e="next"===s?n.nextItem:n.prevItem;classie.addClass(e,"current"),m(n.currentItem,"next"===s?o:a),n.nextItem&&m(n.nextItem,"next"===s?"":i),n.prevItem&&m(n.prevItem,"next"===s?i:""),r&&m(r,"next"===s?a:o);var t=function(e){if(h){if(-1===e.propertyName.indexOf("transform"))return!1;this.removeEventListener(l,t)}n.prevItem&&"next"===s?classie.removeClass(n.prevItem,"show"):n.nextItem&&"prev"===s&&classie.removeClass(n.nextItem,"show"),"next"===s?(n.prevItem=n.currentItem,n.currentItem=n.nextItem,r&&(n.nextItem=r)):(n.nextItem=n.currentItem,n.currentItem=n.prevItem,r&&(n.prevItem=r)),n.current="next"===s?n.current+1:n.current-1,n.isAnimating=!1};h?n.currentItem.addEventListener(l,t):t()},25)}},e.prototype._closeSlideshow=function(e){classie.removeClass(this.el,"slideshow-open"),classie.removeClass(this.slideshow,"animatable");var t=this,s=function(e){if(h){if("ul"!==e.target.tagName.toLowerCase())return;this.removeEventListener(l,s)}classie.removeClass(t.currentItem,"current"),classie.removeClass(t.currentItem,"show"),t.prevItem&&classie.removeClass(t.prevItem,"show"),t.nextItem&&classie.removeClass(t.nextItem,"show"),t.slideshowItems.forEach(function(e){m(e,"")}),t.isSlideshowVisible=!1};h?this.el.addEventListener(l,s):s()},e.prototype._setViewportItems=function(){this.currentItem=null,this.prevItem=null,this.nextItem=null,0<this.current&&(this.prevItem=this.slideshowItems[this.current-1]),this.current<this.itemsCount-1&&(this.nextItem=this.slideshowItems[this.current+1]),this.currentItem=this.slideshowItems[this.current]},e.prototype._resizeHandler=function(){var e=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(function(){e._resize(),e._resizeTimeout=null},50)},e.prototype._resize=function(){if(this.isSlideshowVisible){if(this.prevItem){var e=Number(-1*(d()/2+this.prevItem.offsetWidth/2));m(this.prevItem,c?"translate3d("+e+"px, 0, -150px)":"translate("+e+"px)")}if(this.nextItem){e=Number(d()/2+this.nextItem.offsetWidth/2);m(this.nextItem,c?"translate3d("+e+"px, 0, -150px)":"translate("+e+"px)")}}},i.CBPGridGallery=e}(window);




















